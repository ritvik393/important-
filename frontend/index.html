<!DOCTYPE html>
<html>

<head>

<title>Send Complaint</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body class="bg-dark text-light">

<div class="container mt-5">

<h2>Send Complaint</h2>

<input id="name" class="form-control" placeholder="Name"><br>

<input id="mobile" class="form-control" placeholder="Mobile"><br>

<textarea id="msg" class="form-control" placeholder="Message"></textarea><br>

<button class="btn btn-success" onclick="send()">Submit</button>

</div>


<script>

let lat=0,lng=0

navigator.geolocation.getCurrentPosition(p=>{

 lat=p.coords.latitude
 lng=p.coords.longitude

})


function send(){

fetch("http://127.0.0.1:5000/api/complaint",{

 method:"POST",

 headers:{
  "Content-Type":"application/json"
 },

 body:JSON.stringify({

  name:name.value,
  mobile:mobile.value,
  message:msg.value,

  lat:lat,
  lng:lng
 })

})

alert("Complaint Sent")

}

</script>

</body>
</html>
<h2>HQ Login</h2>

<input id="u" placeholder="Username"><br><br>
<input id="p" type="password" placeholder="Password"><br><br>

<button onclick="login()">Login</button>

<script>

function login(){

fetch("http://127.0.0.1:5000/api/login",{

 method:"POST",

 headers:{
  "Content-Type":"application/json"
 },

 body:JSON.stringify({

  username:u.value,
  password:p.value
 })

})

.then(r=>r.json())
.then(d=>{

 if(d.status=="ok")
  location="dashboard.html"
 else
  alert("Wrong Login")

})

}

</script>
<!DOCTYPE html>
<html>

<head>

<title>Dashboard</title>

<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>

</head>

<body>

<h2>HQ Dashboard</h2>

<div id="map" style="height:400px"></div>

<table border="1" id="tbl"></table>


<script>

const socket = io("http://127.0.0.1:5000")

let map


function init(){

 map=new google.maps.Map(document.getElementById("map"),{

  zoom:12,
  center:{lat:28.6,lng:77.2}

 })

 load()

}


socket.on("new",load)
socket.on("update",load)


function load(){

fetch("http://127.0.0.1:5000/api/complaints")

.then(r=>r.json())
.then(d=>{

 let h="<tr><th>Name</th><th>Msg</th><th>Status</th></tr>"

 d.forEach(c=>{

  h+=`<tr>

  <td>${c.name}</td>
  <td>${c.msg}</td>
  <td>${c.status}</td>

  </tr>`

  new google.maps.Marker({

   position:{
    lat:parseFloat(c.lat),
    lng:parseFloat(c.lng)
   },

   map:map
  })

 })

 tbl.innerHTML=h

})

}

init()

</script>

</body>
</html>
